---
layout: page
title: Technologieplauscherl - Statistik
permalink: /stats/
---
<div class="grid">
	<h2>Top Plauscher</h2>
	<div class="speakers speakers--stats">
	{% comment %}
	Dynamically count speaker appearances across all plauscherl events.
	Handles speakers with "&" by splitting them and ignoring shared images.
	{% endcomment %}
	{% assign speaker_counts = "" %}
	
	{% for event in site.plauscherl %}
		{% for speaker in event.speakers %}
			{% if speaker.name %}
				{% assign names = speaker.name | split: "&" %}
				{% assign img = speaker.img %}
				{% if names.size > 1 %}
					{% assign img = "" %} {% comment %}Ignore shared images{% endcomment %}
				{% endif %}
				
				{% for n in names %}
					{% assign stripped_name = n | strip %}
					{% comment %}Handle name changes via _data/speaker_aliases.yml{% endcomment %}
					{% if site.data.speaker_aliases[stripped_name] %}
						{% assign stripped_name = site.data.speaker_aliases[stripped_name] %}
					{% endif %}
					{% assign speaker_counts = speaker_counts | append: stripped_name | append: "|||" | append: img | append: ":::" %}
				{% endfor %}
			{% endif %}
		{% endfor %}
	{% endfor %}

	{% assign speaker_entries = speaker_counts | split: ":::" %}
	
	{% comment %} Extract unique speakers {% endcomment %}
	{% assign unique_speakers = ";;;" %}
	{% for entry in speaker_entries %}
		{% assign parts = entry | split: "|||" %}
		{% assign name = parts[0] | strip %}
		{% assign check_name = ";;;" | append: name | append: ";;;" %}
		{% if name != "" %}
			{% unless unique_speakers contains check_name %}
				{% assign unique_speakers = unique_speakers | append: name | append: ";;;" %}
			{% endunless %}
		{% endif %}
	{% endfor %}

	{% assign unique_names = unique_speakers | remove_first: ";;;" | split: ";;;" %}
	{% assign speakers_with_count = "" %}
	
	{% comment %} Count occurrences and find latest image {% endcomment %}
	{% for uname in unique_names %}
		{% assign count = 0 %}
		{% assign speaker_img = "" %}
		
		{% for entry in speaker_entries %}
			{% assign parts = entry | split: "|||" %}
			{% assign name = parts[0] | strip %}
			
			{% if name == uname %}
				{% assign count = count | plus: 1 %}
				{% assign img = parts[1] %}
				{% if img and img != "" %}
					{% assign speaker_img = img %}
				{% endif %}
			{% endif %}
		{% endfor %}
		
		{% if count > 0 %}
			{% comment %}Zero-pad count for correct string sorting (e.g. 00012 vs 00008){% endcomment %}
			{% assign count_padded = count | prepend: "00000" | slice: -5, 5 %}
			{% assign speakers_with_count = speakers_with_count | append: count_padded | append: "|" | append: uname | append: "|" | append: speaker_img | append: ";;;" %}
		{% endif %}
	{% endfor %}

	{% assign sorted_speakers = speakers_with_count | split: ";;;" | sort | reverse %}
	
	{% assign displayed = 0 %}
	{% for speaker_entry in sorted_speakers %}
		{% if speaker_entry != "" and displayed < 10 %}
			{% assign s_parts = speaker_entry | split: "|" %}
			{% assign s_count = s_parts[0] | plus: 0 %} {% comment %}Convert back to integer{% endcomment %}
			{% assign s_name = s_parts[1] %}
			{% assign s_img = s_parts[2] %}
			
			<div class="speaker">
				<img src="{{ s_img }}" alt="{{ s_name }}" aria-hidden="true" class="speaker__img">
				<div class="speaker__info">
					<span class="speaker__name" itemprop="performer">{{ s_name }}</span>
					<span class="speaker__count">{{ s_count }}</span>
				</div>
			</div>
			{% assign displayed = displayed | plus: 1 %}
		{% endif %}
	{% endfor %}
	</div>
	<h2>Top Veranstalter</h2>
	<div class="map" id="map-canvas"></div>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@10.7.0/ol.css" integrity="sha512-UCLoDc+FJmck20rmYmTu5zzktNTRGIU3syqavD+KlU4BeLkw6LmcrQunxOw2iQ7hvKsApGBlWqbiy5hAudSQyw==" crossorigin="anonymous" type="text/css">
	<script src="https://cdn.jsdelivr.net/npm/ol@10.7.0/dist/ol.js" integrity="sha512-tymZ5z004JrqdqWRw1niDkYSLuAkmQ2yonPLbwwvKDdAbGYkEOpv8SsmRvrV5xQkX7g/b59lJ4V5gwio/OaqPQ==" crossorigin="anonymous" type="application/javascript"></script>
	<script type="application/javascript">
	let vectorSource;
	// Load data dynamically generated via "LocationDataGenerator"
	const locations = {{ site.data.generated_metadata.locations | jsonify }};

	function initMap() {
		const createMarker = (loc, map, vectorSource) => vectorSource.addFeature(
			new ol.Feature({
				geometry: new ol.geom.Point(ol.proj.fromLonLat(loc.coordinates)),
				name: loc.name,
				count: loc.count
			}));
		
		// Create vector source and layer for markers
		vectorSource = new ol.source.Vector();
		const vectorLayer = new ol.layer.Vector({
			source: vectorSource,
			style: new ol.style.Style({
				image: new ol.style.Icon({
					anchor: [0.5, 1],
					anchorXUnits: 'fraction',
					anchorYUnits: 'fraction',
					src: '/img/map-pin.svg',
					scale: 1
				})
			})
		});

		// Create the map in dedicated div
		const map = new ol.Map({
			target: 'map-canvas',
			layers: [
				new ol.layer.Tile({
					source: new ol.source.OSM()
				}),
				vectorLayer
			],
			view: new ol.View({
				center: ol.proj.fromLonLat([14.290556, 48.303056]),
				zoom: 12
			}),
			controls: ol.control.defaults.defaults()
		});

		// Add markers
		locations.forEach((loc) => createMarker(loc, map, vectorSource));

		// Fit view to show all markers
		if (locations.length > 0) {
			map.getView().fit(vectorSource.getExtent(), {
				padding: [20, 20, 20, 20],
				maxZoom: 16
			});
		}

		// Create popup overlay
		const popup = new ol.Overlay({
			element: document.createElement('div'),
			positioning: 'bottom-center',
			stopEvent: false,
			offset: [0, -50]
		});
		map.addOverlay(popup);

		// Add hover effect for pins
		map.on('pointermove', (evt) => {
			const feature = map.forEachFeatureAtPixel(evt.pixel, (feature) => feature);
			map.getTargetElement().style.cursor = feature ? 'pointer' : '';
		});

		map.on('singleclick', function (evt) {
			const feature = map.forEachFeatureAtPixel(evt.pixel, (feature) => feature );

			if (feature) {
				popup.setPosition(feature.getGeometry().getCoordinates());
				popup.getElement().innerHTML = '<div style="background: white; color: black; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">' +
					feature.get('name') + ': ' + feature.get('count') + 'x</div>';
			} else {
				popup.setPosition(undefined);
				popup.getElement().innerHTML = '';
			}
		});
	}

	// Initialize when page loads
	document.addEventListener('DOMContentLoaded', initMap);
</script>
</div>