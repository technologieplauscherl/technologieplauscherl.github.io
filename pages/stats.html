---
layout: page
title: Technologieplauscherl - Statistik
permalink: /stats/
---
<div class="grid">
	<h2>Top Plauscher</h2>
	<div class="speakers speakers--stats">
	{% comment %}
	Dynamically count speaker appearances across all plauscherl events
	{% endcomment %}
	{% assign speaker_counts = "" %}
	{% for event in site.plauscherl %}
		{% if event.speakers %}
			{% for speaker in event.speakers %}
				{% if speaker.name %}
					{% assign speaker_counts = speaker_counts | append: speaker.name | append: "|||" | append: speaker.img | append: ":::" %}
				{% endif %}
			{% endfor %}
		{% endif %}
	{% endfor %}

	{% comment %}
	Parse and count unique speakers
	{% endcomment %}
	{% assign speaker_entries = speaker_counts | split: ":::" %}
	{% assign unique_speakers = "" %}
	
	{% for entry in speaker_entries %}
		{% if entry != "" %}
			{% assign parts = entry | split: "|||" %}
			{% assign name = parts[0] | strip %}
			{% if name != "" %}
				{% unless unique_speakers contains name %}
					{% assign unique_speakers = unique_speakers | append: name | append: ";;;" %}
				{% endunless %}
			{% endif %}
		{% endif %}
	{% endfor %}

	{% assign unique_names = unique_speakers | split: ";;;" %}
	{% assign speakers_with_count = "" %}
	
	{% comment %}
	Count occurrences for each unique speaker
	{% endcomment %}
	{% for uname in unique_names %}
		{% if uname != "" %}
			{% assign count = 0 %}
			{% assign speaker_img = "" %}
			{% for entry in speaker_entries %}
				{% if entry != "" %}
					{% assign parts = entry | split: "|||" %}
					{% assign name = parts[0] | strip %}
					{% if name == uname %}
						{% assign count = count | plus: 1 %}
						{% comment %}Always update image to get the most recent one{% endcomment %}
						{% assign speaker_img = parts[1] %}
					{% endif %}
				{% endif %}
			{% endfor %}
			{% comment %}Format: count|name|img - zero-pad count for sorting{% endcomment %}
			{% if count < 10 %}
				{% assign count_padded = "0" | append: count %}
			{% else %}
				{% assign count_padded = count %}
			{% endif %}
			{% assign speakers_with_count = speakers_with_count | append: count_padded | append: "|" | append: uname | append: "|" | append: speaker_img | append: ";;;" %}
		{% endif %}
	{% endfor %}

	{% assign sorted_speakers = speakers_with_count | split: ";;;" | sort | reverse %}
	
	{% comment %}
	Display top 10 speakers with most recent image
	{% endcomment %}
	{% assign displayed = 0 %}
	{% for speaker_entry in sorted_speakers %}
		{% if speaker_entry != "" and displayed < 10 %}
			{% assign s_parts = speaker_entry | split: "|" %}
			{% assign s_count = s_parts[0] | plus: 0 %}
			{% assign s_name = s_parts[1] %}
			{% assign s_img = s_parts[2] %}
			<div class="speaker">
				<img src="{{ s_img }}" alt="{{ s_name }}" aria-hidden="true" class="speaker__img">
				<div class="speaker__info">
					<span class="speaker__name" itemprop="performer">{{ s_name }}</span>
					<span class="speaker__count">{{ s_count }}</span>
				</div>
			</div>
			{% assign displayed = displayed | plus: 1 %}
		{% endif %}
	{% endfor %}
	</div>
	<h2>Top Veranstalter</h2>
	<div class="map" id="map-canvas"></div>
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYQWiueu7EQxRWhVgIjjcRHi5dRfQlJfU"></script>
	<script type="text/javascript">
		var locations = [];
		{% for location in site.data.metadata.locations %}
		locations.push({
			pos: new google.maps.LatLng({{location.pos.lat}}, {{location.pos.lng}}),
			name: '{{location.name}}',
			count: {{location.count}}
		});
		{% endfor %}
		var bounds = new google.maps.LatLngBounds ();
		for(var i = 0, len = locations.length; i < len; i++) {
			bounds.extend(locations[i].pos);
		};

		function createMarker(loc, map) {
			var marker = new google.maps.Marker({
				position: loc.pos,
				title: loc.name,
				map: map
			});

			var infowindow = new google.maps.InfoWindow({
				content: loc.name + ': ' + loc.count + 'x'
			});


			google.maps.event.addListener(marker, 'click', function() {
				infowindow.open(map, marker);
			});
		}

		function initialize() {
			var mapOptions = {
				zoom: 18,
				scrollwheel: false,
				draggable: true,
				zoomable: true,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			var map = new google.maps.Map(document.getElementById("map-canvas"),
				mapOptions);

			var elems = [];

			for(var i = 0; i < locations.length; i++) {
				createMarker(locations[i], map);
			}

			map.fitBounds(bounds);
		}
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</div>
